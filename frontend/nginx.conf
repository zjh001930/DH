# frontend/nginx.conf
# 适用于 React (单页应用) 的 Nginx 生产配置

server {
    # 监听容器内部的 80 端口
    listen 80;

    # 设置静态文件的根目录
    root /usr/share/nginx/html;

    # 默认首页
    index index.html index.htm;

    location / {
        # 【关键配置】
        # 尝试按顺序查找文件:
        # 1. $uri (用户请求的精确文件, e.g., /static/js/main.js)
        # 2. $uri/ (用户请求的目录, e.g., /admin/)
        # 3. /index.html (如果前两者都找不到，则回退到 React 的入口)
        try_files $uri $uri/ /index.html;
    }

    # 新增：前端统一调用 /api，代理到后端容器
    location /api/ {
        proxy_pass http://backend:8000/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}